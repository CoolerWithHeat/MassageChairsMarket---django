<!DOCTYPE html>
{% load static %}
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="{% static 'images/Brand.png' %}" type="image/x-icon">
        <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/cart.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/CartAnimation.css' %}">
        <link rel="stylesheet" href="{% static 'css/templatemo-hexashop.css' %}">
        <link rel="stylesheet" href="{% static 'css/searchfield.css' %}">
        <link rel="stylesheet" href="{% static 'css/filterSlider.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/masterCardAnimation.css' %}">   
    </head>
    <body>
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">

                        <a href="../" class="logo">
                            <img id="LogoPoint" class="brandLogo" src="{% static 'images/companyLogo.png' %}">   
                        </a>

                        <ul class="nav">
                            <li class="scroll-to-section">
                                <div class="CartBoundary" style="cursor: pointer;">
                                    <a href="../Cart/">
                                        <i class="fa" style="font-size:25px">&#xf07a;</i>
                                        <span id="lblCartCount" class='badge badge-warning'> 0 </span>
                                    </a>
                                </div>                  
                            </li>
                            <li class="scroll-to-section"><a href="#top">Home</a></li>
                                <li class="submenu">
                                    <a href="javascript:;">Pages</a>
                                    <ul>
                                        <li><a href="../../../">Home</a></li>
                                        <li><a href="../../FindProduct/">Products</a></li>
                                        <li><a href="../../../FAQ/">FAQ</a></li>
                                    </ul>
                                </li>
                            <li class="submenu">                               
                                <a href="javascript:;">Brands</a>
                                <ul>
                                    <li><a href="#">Kahuna</a></li>
                                    <li><a href="#">Osaki</a></li> 
                                    <li><a href="#">Real Relax</a></li>
                                    <li><a href="#">Homedics</a></li>
                                </ul>
                            </li>
                            <li class="scroll-to-section onpage"><a href="#explore">Explore</a></li>
                            <li class="scroll-to-section"><a href="/productsPage">Products</a></li>
                        </ul>        
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                    </nav>

                </div>
                
            </div>
            <div class="searchBox">
                <input id="SearchKeywordHolder" class="searchInput"type="text" name="" placeholder="Search">
                <button onclick="OpenSearchBar()" class="searchButton" href="#">
                    <div class="searchIcon">
                        <i class="material-icons">
                            <i id="SearchIconFA" class="fa fa-search" aria-hidden="true"></i>
                        </i>
                    </div>
                </button>
            </div>
        </div>
        <div id='CartHub'>
            <div class="CartBoundaryFixed MobileCart" style="cursor: pointer;">
                <a href="../../Cart">
                    <i class="fa" style="font-size:24px;">&#xf07a;</i>
                    <span id="lblCartCountMobile" class='badge badge-warning'> 0 </span>
                </a>
            </div>
        </div>
    </header>
    <br><br><br>
    <section class="section" id="products">
        <div class="col-lg-12">
            <div id="LatestAlert" class="section-heading"></div>
        </div>
        <div class="Filters_And_Products_Together">
            <div id="ProductFilters" class="filterWindow">
                <article class="FiltersParent" class="filter-group">
                    <div class="card-header">
                        <a href="#" data-toggle="collapse" data-target="#collapse_0" aria-expanded="true" class="">
                            <div class="ParentDropDown">
                                <svg style="display:inline-block;" xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z"/>
                                </svg> 
                                <h6 class="parent-title">Filters</h6>
                                <i class="icon-control fa fa-chevron-down"></i>
                            </div>
                        </a>
                    </div>
                </article>
            </div>
            <br>
            <div class="ProductsListingWindow">
                <div class="container">
                    <div id="ProductContainer" class="row"></div>
                    <div id="PaginationSection" class="col-lg-12"></div>
                </div>
            </div>
        </div>
    </section>

    <script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
    <script src="https://polyfill.io/v3/polyfill.js?features=Promise%2CObject.entries%2CObject.assign"></script>
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch.umd.min.js"></script>
    <script src="{% static 'js/popper.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/owl-carousel.js' %}"></script>
    <script src="{% static 'js/accordions.js' %}"></script>
    <script src="{% static 'js/datepicker.js' %}"></script>
    <script src="{% static 'js/scrollreveal.min.js' %}"></script>
    <script src="{% static 'js/waypoints.min.js' %}"></script>
    <script src="{% static 'js/imgfix.min.js' %}"></script>
    <script src="{% static 'js/isotope.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static 'js/SliderHandler.js' %}"></script>

    <script>
        var MinPriceDemonstration;
        var MaxPriceDemonstration;
        var WindowFilters;
        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        function ValidateSearchParam(data) {
            return typeof data === 'string' ? [data] : data
        }

        let filtersReady = false;
        function searchAlgoliaWithParams(RequestedProperties){
            UpdateLoadingStatus(false);
            const client = algoliasearch('K7LWE7RYA4', 'dd84d643cb097b484b87bf0a2c35d742');
            const products = client.initIndex('MassageChair');
            const minPrice = parseFloat(RequestedProperties.minPrice)  || 0;
            const maxPrice = parseFloat(RequestedProperties.maxPrice) || 16000;
            const brandFilters = ValidateSearchParam(RequestedProperties.Brands); 
            const KeywordSearch = RequestedProperties.SearchKey || '*';
            const featureFilters = ValidateSearchParam(RequestedProperties.Features); 
            let brand_filters = '';
            let feature_filters = '';
            const price_filters = `${brandFilters ? ' AND ' : ''}(price > ${minPrice} AND price <= ${maxPrice})${featureFilters ? ' AND ' : ''}`;
            let search_filter = `(brand: 'Osaki' OR brand:Kahuna) AND (price > ${minPrice} AND price <= ${maxPrice})`
            
            if (brandFilters && Array.isArray(brandFilters)){
                const filter = brandFilters.map(each=>`brand: '${each}' `)
                const finalBrandFilter = `(${filter.join('OR ')}) `;
                brand_filters = finalBrandFilter;
            }
            
            if (featureFilters && Array.isArray(featureFilters)){
                const filter = featureFilters.map(each=>`chair_features: '${each}' `)
                const finalBrandFilter = `(${filter.join('OR ')}) `;
                feature_filters = finalBrandFilter;
            }
            
            const searchOptions = {
                hitsPerPage: 100,
                filters: brand_filters+price_filters+feature_filters,
            };

            if (searchOptions.filters){
                products.search(KeywordSearch, searchOptions).then((response) => {
                    const hits = response.hits;
                    console.log('search triggered')
                    setTimeout(() => {
                        UpdateLoadingStatus(true);
                        if (hits.length) {
                            hits.forEach(Each => {
                                if (!filtersReady){if (Each.FilterOptions) PlaceSubFilters(Each.FilterOptions); filtersReady=true}
                                const container = document.getElementById('ProductContainer');
                                const product = extractProductData(Each);
                                container.innerHTML += product;
                            });
                    }else{
                        PlaceSubFiltersByCache();
                    }
                    }, 499);
                })
                .catch(error => {
                    console.error('Algolia search error:', error);
                });
            }
        }
        function removeLatestAlert() {
            var element = document.getElementById("LatestAlert");
            if (element) {
                element.parentNode.removeChild(element);
            }
        }
        function extractProductData(algoliaData) {
            const title = algoliaData.title;
            const price = algoliaData.price;
            const description = algoliaData.description;
            const brand = algoliaData.brand;
            const availableColors = algoliaData.color_options;
            const features = algoliaData.chair_features; 
            const purchased = algoliaData.purchased;
            const rating = algoliaData.rating;
            const posted = algoliaData.posted;
            const product_id = algoliaData.objectID;
            const rating_stars = getRating(rating);
            const Cart = JSON.parse(localStorage.getItem('MassageCart')) || [];
            const style = Cart.some(item => item.product_id === 2) ? "color: rgb(127,255,212);" : null;
            const blackColor_Url = availableColors ? availableColors[0][2] : '';
            if (blackColor_Url){
                const Products = `
                    <div class="col-lg-4">
                        <div class="item">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="../Buy/${product_id}/"><i class="fa fa-eye"></i></a></li>
                                        <li><a href="single-product.html"><i class="fa fa-star"></i></a></li>
                                        <li><a><i style="${style}" data-id="${product_id}" data-type="listed-product" data-color="${availableColors ? availableColors[0][0] : ''}" onclick="AddToCard(event)" class="fa fa-shopping-cart"></i></a></li>
                                    </ul>
                                </div>
                                <img src="${blackColor_Url}" alt="">
                            </div>
                            <div class="down-content">
                                <h4>${title}</h4>
                                <span>$${Number(price).toFixed(2)}</span>
                                <br>
                                ${rating_stars.outerHTML}
                            </div>
                        </div>
                    </div>
                `;

                return Products;
            }
        }

        const SetPagination = (page)=>{
            const frame = document.getElementById('PaginationSection');
            const DesignatedButtons = `
                <div class="pagination">
                    <ul>
                        <li class="active">
                            <a href="#">1</a>
                        </li>
                        <li >
                            <a href="#">2</a>
                        </li>
                        <li>
                            <a href="#">3</a>
                        </li>
                        <li>
                            <a href="#">4</a>
                        </li>
                        <li>
                            <a href="#">></a>
                        </li>
                    </ul>
                </div>`
            ;
            frame.innerHTML = DesignatedButtons;
        };

        function setUrlParam(key, value, multi = false, remove = false) {
            const existingParams = getUrlParams();
            var url = new URL(window.location.href);

            if (url.searchParams.has(key)) {
                var existingValue = url.searchParams.get(key);
                var existingValues = existingValue.split(',');
                if (!remove) {
                    existingValues = existingValues.filter(val => val !== value);
                    if (existingValues.length === 0) {
                        url.searchParams.delete(key);
                    } else {
                        url.searchParams.set(key, existingValues.join(','));
                    }
                } else if (multi) {
                    if (!existingValues.includes(value)) {
                        existingValues.push(value);
                        url.searchParams.set(key, existingValues.join(','));
                    }
                } else {
                    url.searchParams.set(key, value);
                }
            } else {
                url.searchParams.set(key, value);
            }

            window.history.pushState({ path: url.href }, '', url.href);
        }


        function addPriceFilters(maxPrice, minPrice = 0) {
            if (maxPrice){
                setUrlParam('maxPrice', maxPrice || 16000, false, true);
            }else{
                setUrlParam('minPrice', minPrice || 0, false, true);
            }
        }

        function addLatestProductParameter() {
            var url = new URL(window.location.href);
            url.searchParams.set('latest_product', 'true');
            window.history.pushState({ path: url.href }, '', url.href);
        }

        function removeLatestProductParameter() {
            var url = new URL(window.location.href);
            url.searchParams.delete('latest_product');
            window.history.pushState({ path: url.href }, '', url.href);
        }


        $(function() {
            var selectedClass = "";
            $("p").click(function(){
            selectedClass = $(this).attr("data-rel");
            $("#portfolio").fadeTo(50, 0.1);
                $("#portfolio div").not("."+selectedClass).fadeOut();
            setTimeout(function() {
            $("."+selectedClass).fadeIn();
            $("#portfolio").fadeTo(50, 1);
            }, 500);
                
            });
        });

        const getRating = (rating) => {
            const StarsHub = document.createElement('ul');
            StarsHub.className = 'stars';
            const wholeRating = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;

            for (let i = 0; i < wholeRating; i++) {
                const star = document.createElement('li');
                const icon = document.createElement('i');
                icon.className = 'fa fa-star';
                star.appendChild(icon);
                StarsHub.appendChild(star);
            }
            
            const classname = hasHalfStar ? 'fa fa-star' : 'fa fa-star-half';
            const halfStar = document.createElement('li');
            const halfStarIcon = document.createElement('i');
            halfStarIcon.className = classname;
            halfStar.appendChild(halfStarIcon);
            StarsHub.appendChild(halfStar);

            return StarsHub;
        };
        var logoElement = document.getElementById('LogoPoint');
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                logoElement.classList.add('active');
            }, 999);
            setTimeout(() => {
                logoElement.classList.remove('active');
            }, 1699);
        });

        function AnimateLogo(){
            logoElement.classList.add('active');
            setTimeout(() => {
                logoElement.classList.remove('active');
            }, 1000);
        }

        function ManageCart(product) {
            const product_id = product.id
            const quantity = product.quantity || 1
            const selectedColor = product.selectedColor
            const savedProducts = JSON.parse(localStorage.getItem('MassageCart')) || [];
            let isRemoved = false;

            const index = savedProducts.findIndex(product => product.product_id === product_id);

            if (index === -1) {
                savedProducts.push({ product_id, quantity, selectedColor});
            } else {
                savedProducts.splice(index, 1);
                isRemoved = true;
            }

            localStorage.setItem('MassageCart', JSON.stringify(savedProducts));

            return [savedProducts.length, isRemoved];
        }

        function OpenSearchBar(fadeout=true){
            const url_params = getUrlParams();
            const first_time = url_params.SearchKey == undefined;
            const searchBar = document.getElementsByClassName('searchBox')[0];
            const in_closed_state = !searchBar.classList.contains('openedSearch');
            const SearchKeywordHolder = document.getElementById('SearchKeywordHolder');
            const currentKeywordValue = SearchKeywordHolder.value;
            const same = url_params.SearchKey == currentKeywordValue;

            if ((first_time && !currentKeywordValue)){}
            
            else{
                if (!same){
                    AddSearchKeyword(currentKeywordValue);
                    setTimeout(() => {
                        searchBar.classList.remove('openedSearch')
                    }, 333);
                }
            }
            if (in_closed_state)
                searchBar.classList.add('openedSearch')
                AnimateSearchIcon();
        }

        const FadaAwaySearch = (fadeout=true)=>{
            const searchBar = document.getElementsByClassName('searchBox')[0]
            if (!fadeout){
                    searchBar.classList.remove('Appear');
                    searchBar.classList.add('Disappear');
            }else{
                searchBar.classList.remove('Disappear');
                searchBar.classList.add('Appear');
            }
        }

        function CloseSearchBar(fadeout=true){
            const searchBar = document.getElementsByClassName('searchBox')[0]
            const in_open_state = searchBar.classList.contains('openedSearch')
            if (in_open_state)
                searchBar.classList.remove('openedSearch')
                AnimateSearchIcon()
            }
        
        function AnimateSearchIcon() {
            const SearchIcon = document.getElementById('SearchIconFA');
            const className = 'SearchIconAnimation';
            const isAlreadyOpened = SearchIcon.classList.contains(className);
            if (isAlreadyOpened) {
                SearchIcon.classList.remove(className);
                setTimeout(() => {
                SearchIcon.classList.add(className);
                }, 10);

            } else {
                SearchIcon.classList.add(className);
            }
        }

        function TeachHow() {
            const searchInput = document.querySelector('.searchInput');
            const inputText = 'I Want Air Massage';
            let index = 0;
            let addTextIntervalId;

            addTextIntervalId = setInterval(function () {
                searchInput.value = inputText.slice(0, index);
                index++;
                if (index > inputText.length) {
                clearInterval(addTextIntervalId);

                setTimeout(() => {
                    let clearIndex = inputText.length;

                    const clearTextIntervalId = setInterval(function () {
                    searchInput.value = inputText.slice(0, clearIndex);
                    clearIndex--;

                    if (clearIndex < 0) {
                        clearInterval(clearTextIntervalId);
                    }
                    }, 20);
                }, 777);
                }
            }, 50);

            localStorage.setItem('CustomerAwareness', true)
            return true
        }


        function AddToCard(data=null){
            const product_id = data.target.dataset.id ? Number(data.target.dataset.id) : null;
            const product_color = data.target.dataset.color;
            const result = ManageCart({id: product_id, quantity:1, selectedColor:product_color});
            const total_products = result[0];
            const current_color = result[1] ? '#343a40' : 'rgb(127,255,212)';
            const element = data.target;
            const Datapath = document.getElementById('lblCartCount')
            const DatapathMobile = document.getElementById('lblCartCountMobile')
            const Divpath = document.getElementsByClassName('CartBoundary')[0];
            const DivpathMobile = document.getElementsByClassName('MobileCart')[0];
            Divpath.classList.add('animateCart');
            DivpathMobile.classList.add('animateCart');
            Datapath.textContent = total_products;
            DatapathMobile.textContent = total_products;
            if (result[1]){
                element.classList.add('rollback');
                element.classList.remove('CartSelected');
            }
            else{
                element.classList.remove('rollback');
                element.classList.add('CartSelected');
            }
            setTimeout(() => {
                element.style.color = current_color;
            }, 333);
            setTimeout(() => {
                Divpath.classList.remove('animateCart');
                DivpathMobile.classList.remove('animateCart');
            }, 999);
        }

        function checkProductIdExists(digit, dataArray) {
            for (var i = 0; i < dataArray.length; i++) {
                if (dataArray[i].product_id === digit) {
                    return true;
                }
            }
            return false;
        }

        function SetProductCard(forCartValidation=false){
            const Cart = JSON.parse(localStorage.getItem('MassageCart')) || [];
            const total_products = Cart.length;
            const Datapath = window.innerWidth > 767 ? document.getElementById('lblCartCount') : document.getElementById('lblCartCountMobile');
            Datapath.textContent = total_products;
            const listerProducts = document.querySelectorAll('[data-type="listed-product"]');
            listerProducts.forEach(TheProduct=>{
                const product_id = Number(TheProduct.getAttribute('data-id'));
                const product_added = checkProductIdExists(product_id, Cart);
                TheProduct.style.color = product_added ? 'rgb(127,255,212)' : '';
            })
        }

        function HandleSearchBarState(){
            const SearchBar = document.getElementsByClassName('searchBox')[0];
            const AwareCustomer = JSON.parse(localStorage.getItem('CustomerAwareness')) || false
            if (!AwareCustomer){
                setTimeout(() => {
                    OpenSearchBar();
                }, 999);

                setTimeout(() => {
                    TeachHow();
                }, 1500);

                setTimeout(() => {
                    CloseSearchBar();
                }, 4000);

                setTimeout(() => {
                    window.addEventListener("scroll", function() {
                        const searchBar = document.getElementsByClassName('searchBox')[0]
                        const in_open_state = searchBar.classList.contains('openedSearch')
                        if (window.scrollY > 100) {
                            if (in_open_state){
                                CloseSearchBar();
                            }
                        }
                        if (window.scrollY < 50) {
                            if (!in_open_state)
                                OpenSearchBar();
                        }
                    });    
                }, 3800);
                
            }else{
                window.addEventListener("scroll", function() {
                        const searchBar = document.getElementsByClassName('searchBox')[0]
                        const in_open_state = searchBar.classList.contains('openedSearch')
                        if (window.scrollY > 100) {
                            if (in_open_state){
                                CloseSearchBar();
                            }
                        }
                        if (window.scrollY < 50) {
                            if (!in_open_state)
                                OpenSearchBar();
                        }
                        if (window.scrollY > 450) {
                            if (!in_open_state)
                            FadaAwaySearch(false);
                        }
                        if (window.scrollY < 300) {
                            if (!in_open_state)
                            FadaAwaySearch();
                        }
                    });
                }
        }

        function UpdateLoadingStatus(remove=true){
            if (remove){
                const loader = document.getElementById('loader');
                if (loader)
                    loader.remove();
            }else{
                const loading_window = document.getElementById('ProductContainer');
                loading_window.innerHTML = `<div id="loader" style="margin-top: 250px;" class="loader"></div>`;
            }
            AppendLatestAlert();
        };

        function removeUrlParam(key, valueToRemove) {
            var url = new URL(window.location.href);
            var existingValue = url.searchParams.get(key);
            if (existingValue) {
                var values = existingValue.split(',');
                var updatedValues = values.filter(val => val !== valueToRemove);

                if (updatedValues.length === 0) {
                    url.searchParams.delete(key);
                } else {
                    url.searchParams.set(key, updatedValues.join(','));
                }

                window.history.pushState({ path: url.href }, '', url.href);
            }
        }

        function checkIfActivated(data, comparisonValue) {
            if (Array.isArray(data)) {
                return data.includes(comparisonValue);
            } else if (typeof data === 'string') {
                return data === comparisonValue;
            } else {
                return false;
            }
        }

        function getUrlParams() {
            const searchParams = new URLSearchParams(window.location.search);
            const params = {};
            for (const [key, value] of searchParams.entries()) {
                if (value.includes(',')) {
                    params[key] = value.split(',');
                } else {
                    params[key] = value;
                }
            }
            return params;
        }

        function isObject(variable) {
            return variable instanceof Object && variable !== null;
        }

        function ApplyPrice(){
            const preferred_price_min = document.getElementById('MinPriceField');
            const preferred_price_max = document.getElementById('MaxPriceField');
            const min_price = preferred_price_min.value || 0
            const max_price = preferred_price_max.value || 0
            if (preferred_price_min && preferred_price_max)
                addPriceFilters(max_price, min_price);
        };

        function HandleFilterCheckbox(event){
            const target_tag = event.target
            const is_checked = target_tag.checked
            const filterData = target_tag.name  
            const FilterParent = target_tag.getAttribute('data-parent') 
            setUrlParam(FilterParent, filterData, true, is_checked);
            const infrequest_request =  debounce(TriggerFilter, 599);
            infrequest_request();
        }

        function removeMoneyFormat(moneyString) {
            const cleanString = moneyString.replace(/[$,]/g, '');
            const numericValue = parseFloat(cleanString);
            return numericValue;
        }

        function TriggerFilter(updatedProperties){
            const params = getUrlParams();
            const finalParams = isObject(updatedProperties) ? {...params, ...updatedProperties} : params;
            searchAlgoliaWithParams(finalParams);
        }; 

        function handleSlider(event) {
            const dataId = event.target.getAttribute('data-id');
            const decided_price = removeMoneyFormat(event.target.value);
            const for_max_price = dataId == 'maxPrice';
            TriggerFilter({[dataId]: decided_price});
            const update_price = debounce(addPriceFilters, 999);
            if (for_max_price){
                update_price(decided_price);
            }else{
                update_price(false, decided_price);
            }
        }

        function deploySubFilters(options){
            const current_params = getUrlParams();
            const getOption = (optionName, amountAvailable, filterName)=> {
                    const already_activated = checkIfActivated(current_params[filterName], optionName);
                    const amount = amountAvailable ? amountAvailable : (29 + (Math.floor(Math.random() * 8) + -1))
                    return  `   <label class="custom-control custom-checkbox">
                                    <input onchange='HandleFilterCheckbox(event)' ${already_activated ? 'checked' : ''} name='${optionName}' data-parent='${filterName}' type="checkbox" class="custom-control-input">
                                    <div style="cursor:pointer;" class="custom-control-label">${optionName}<b class="badge badge-pill badge-info float-right">${amount}</b></div>
                                </label>
                            `
            }
            let ParentOptions = [];
            var objectIDs = 3;
            if (isObject(options)){
                for (let key in options){
                    const filterName = key;
                    const filterOptions = options[key];
                    let processedOptions = [];
                    if (Array.isArray(filterOptions)){
                        for (const obj of filterOptions) {
                            for (const key in obj) {
                                if (obj.hasOwnProperty(key)) {
                                    const value = obj[key];
                                    processedOptions.push(getOption(key, value, filterName))
                                }
                            }
                        }
                    }
                    if (processedOptions){
                        processedOptions = processedOptions.join('');
                        ParentOptions.push(`
                            <article id="additionalSubFilters" class="filter-group">
                                <div class="card-header">
                                    <a href="#" data-toggle="collapse" data-target="#collapse_${objectIDs}" aria-expanded="false" class="">
                                        <i class="icon-control fa fa-chevron-down"></i>
                                        <h6 data-filtername='SubFilterElement' class="title">${filterName}</h6>
                                    </a>
                                </div>
                                <div class="filter-content collapse FilterWindow_${objectIDs}" id="collapse_${objectIDs}" style="">
                                    <div class="card-body">
                                        ${processedOptions}
                                    </div>
                                </div>
                            </article>
                            <br>
                        `)
                        objectIDs += 1;
                    }
                }
            if (ParentOptions)
                ParentOptions = ParentOptions.join('');
                return ParentOptions
            }
        }

    function arrangeFilters(){
            TriggerFilter();
            const FilterWindow = document.getElementById('ProductFilters');
            const filterObject = `
            <article class="FiltersParent" class="filter-group">
                <div class="card-header">
                    <a href="#" data-toggle="collapse" data-target="#collapse_0" aria-expanded="true" class="">
                        <div class="ParentDropDown">
                            <svg style="display:inline-block;" xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z"/>
                            </svg> 
                            <h6 class="parent-title">Filters</h6>
                            <i class="icon-control fa fa-chevron-down"></i>
                        </div>
                    </a>
                </div>
                <div class="filter-content collapse show" id="collapse_0" style="">
                        <div class="card-body">
                            <article class="filter-group">
                                <div class="card-header">
                                    <a href="#" data-toggle="collapse" data-target="#collapse_1" aria-expanded="true" class="">
                                        <i class="icon-control fa fa-chevron-down"></i>
                                        <h6 class="title">Price Range</h6>
                                    </a>
                                </div>
                                <div class="filter-content collapse show" id="collapse_1">
                                    <div class="card-body">
                                        <div class="slider-container">
                                            <div class="row">
                                            <div class="col-sm-12">
                                                <div id="slider-range"></div>
                                            </div>
                                            </div>
                                            <div class="row">
                                            <div class="col-sm-12">
                                                <form>
                                                    <input id="PriceSliderMin" type="hidden" name="min-value" value="">
                                                    <input id="PriceSliderMax" type="hidden" name="max-value" value="">
                                                </form>
                                            </div>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="MinLabel">Min</label>
                                                <input data-id="minPrice" id="MinPriceHub" type="text" class="form__field" placeholder="$0" />
                                            </div>
                                            <div class="form-group text-right col-md-6">
                                                <label class="MaxLabel">Max</label>
                                                <input data-id="maxPrice" id="MaxPriceHub" type="text" class="form__field" placeholder="$15999" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                            <div id="SubfiltersBase">
                            </div>
                        </div>
                </div>
            </article>`
            FilterWindow.innerHTML = filterObject;
            return true;
        }

        function AddSearchKeyword(keyword){
            setUrlParam('SearchKey', keyword, false, true)
            TriggerFilter();
            return true;
        }
        
        function AppendLatestAlert(){
            setTimeout(() => {
                const url_params = getUrlParams();
                const NoFiltersYet = !Object.keys(url_params).length > 0;
                const window = document.getElementById('LatestAlert');
                if (NoFiltersYet){
                    window.innerHTML = `
                        <h2>Explore Latest Products</h2>
                        <span>By MassageChairsMarket.com</span>
                    `;
                }else{
                    window.innerHTML = '';
                }
            }, 599);
        }

        function SetSearchValue(){
            const params = getUrlParams();
            const search_value = params.SearchKey
            if(!(search_value == undefined)){
                const value_window = document.getElementById('SearchKeywordHolder');
                value_window.value = search_value;
            }
        }

        function SubFiltersExist(){
            const elements = document.querySelectorAll('[data-filtername="SubFilterElement"]');
            const expectedFilters = {'Brands': true, 'Features': true,}
            elements.forEach(element => {
                const brandName = element.textContent;
                if (!expectedFilters[brandName]){
                    return false
                }
            });
            return elements.length == 0 ? false : true
        }

        function PlaceSubFilters(filters){
            const already_mounted = SubFiltersExist();
            if (!already_mounted){
                const SubfiltersPlace = document.getElementById('SubfiltersBase')
                const SubFilters = deploySubFilters(filters);
                SubfiltersPlace.innerHTML = SubFilters;
                localStorage.setItem('CachedFilterProperties', JSON.stringify(filters))
            }
        }
        function PlaceSubFiltersByCache(filters){
            const already_mounted = SubFiltersExist();
            if (!already_mounted){
                const RawData = localStorage.getItem('CachedFilterProperties')
                const DataReady = RawData ? JSON.parse(RawData) : null
                if (DataReady){
                    const SubfiltersPlace = document.getElementById('SubfiltersBase')
                    const SubFilters = deploySubFilters(DataReady);
                    SubfiltersPlace.innerHTML = SubFilters;
                }
            }
        }
        
        const ready = arrangeFilters();

        if (ready){
            SetSearchValue();
            setTimeout(() => {
                MinPriceDemonstration = document.getElementById("MinPriceHub");
                MaxPriceDemonstration = document.getElementById("MaxPriceHub");   
                setTimeout(() => {
                        MaxPriceRepresentor.addEventListener('onchange', debounce(handleSlider, 599))
                }, 399);
                setTimeout(() => {
                        MinPriceDemonstration.addEventListener('onchange', debounce(handleSlider, 599))
                }, 399);
                
            }, 111);
        }

        const CloseFiltersForMobiles = ()=>{
            const deviceWidth = window.innerWidth;
            if (Number(deviceWidth) < 770){
                const FilterWindow = document.getElementsByClassName('ParentDropDown');
                if (FilterWindow[0])
                    FilterWindow[0].click();
            }
        };

        function ClickSearchForClient(){
            const searchTriggerButton = document.getElementsByClassName('searchButton')[0];
            if(searchTriggerButton)
                searchTriggerButton.click()
        }

        window.addEventListener("keypress", function(event) {
            if (event.keyCode === 13) {
                ClickSearchForClient();
            }
        });

        window.addEventListener('pageshow', function(event) {
            CloseFiltersForMobiles();
            SetProductCard();
            setTimeout(() => {
                SetProductCard(true);
                HandleSearchBarState();
            }, 699);
        });
    </script>

</body>
</html>